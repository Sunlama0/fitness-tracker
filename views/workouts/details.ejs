<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©tails de la S√©ance</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 flex flex-col min-h-screen">

    <!-- Navbar -->
    <%- include('../partials/navbar') %>

        <!-- Contenu principal -->
        <div class="container mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-[#E30613]">üìÖ D√©tails de la S√©ance</h2>
                <a href="/workouts/<%= session._id %>/exercises/add"
                    class="bg-[#E30613] hover:bg-[#C20510] text-white font-bold py-3 px-6 rounded-lg transition">
                    ‚ûï Ajouter un exercice
                </a>
            </div>

            <!-- Informations g√©n√©rales -->
            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <p class="text-lg font-semibold">üìå Type d'entra√Ænement : <span class="text-[#E30613]">
                        <%= session.type %>
                    </span></p>
                <p class="text-lg font-semibold">üìÖ Date : <span class="text-gray-700">
                        <%= session.date.toLocaleDateString() %>
                    </span></p>
            </div>

            <!-- Liste des exercices -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-2xl font-semibold mb-4">üèãÔ∏è‚Äç‚ôÇÔ∏è Exercices</h3>

                <% if (session.exercises.length===0) { %>
                    <p class="text-gray-500 text-center">Aucun exercice ajout√© pour cette s√©ance.</p>
                    <% } else { %>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <% session.exercises.forEach(exercise=> { %>
                                <div
                                    class="p-4 bg-gray-50 rounded-lg shadow flex flex-col justify-between transition hover:shadow-lg">
                                    <div>
                                        <p class="text-lg font-bold text-gray-800">
                                            <%= exercise.name %>
                                        </p>
                                        <p class="text-sm text-gray-500">üî• MET: <%= exercise.met %> | ‚è≥ Dur√©e: <%=
                                                    exercise.duration %> min</p>
                                        <p class="text-sm text-gray-500 font-bold">üí™ Calories br√ªl√©es : <span
                                                class="text-[#E30613]">
                                                <%= exercise.caloriesBurned.toFixed(2) %> kcal
                                            </span></p>
                                    </div>

                                    <!-- Boutons d'action -->
                                    <div class="flex justify-between mt-4">
                                        <button
                                            onclick="openEditModal('<%= exercise._id %>', '<%= exercise.name %>', '<%= exercise.duration %>')"
                                            class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md text-sm transition">
                                            ‚úè Modifier
                                        </button>

                                        <button onclick="confirmDelete('<%= exercise._id %>')"
                                            class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-md text-sm transition">
                                            ‚ùå Supprimer
                                        </button>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                        <% } %>
            </div>
        </div>

        <!-- Modal d'√©dition -->
        <div id="editExerciseModal"
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
            <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
                <h3 class="text-2xl font-semibold mb-4 text-[#E30613]">‚è≥ Modifier la dur√©e</h3>
                <form id="editForm" method="POST">
                    <input type="hidden" name="exerciseId" id="editExerciseId">

                    <p class="text-lg font-semibold text-gray-700 mb-2">
                        Exercice : <span id="editExerciseName" class="text-gray-900 font-bold"></span>
                    </p>

                    <label class="block font-semibold mt-4 text-gray-700">Dur√©e (minutes)</label>
                    <input type="number" name="duration" id="editExerciseDuration"
                        class="w-full border p-3 rounded-lg bg-gray-50" required>

                    <div class="flex justify-end mt-4">
                        <button type="button" onclick="closeEditModal()"
                            class="mr-2 px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition">
                            Annuler
                        </button>
                        <button type="submit"
                            class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition">
                            ‚úÖ Enregistrer
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Footer -->
        <%- include('../partials/footer') %>

            <!-- Script pour g√©rer l'√©dition et suppression -->
            <script>
                function openEditModal(id, name, duration) {
                    document.getElementById("editExerciseId").value = id;
                    document.getElementById("editExerciseName").innerText = name;
                    document.getElementById("editExerciseDuration").value = duration;

                    document.getElementById("editForm").action = `/workouts/<%= session._id %>/exercises/${id}/edit`;

                    document.getElementById("editExerciseModal").classList.remove("hidden");
                }

                function closeEditModal() {
                    document.getElementById("editExerciseModal").classList.add("hidden");
                }

                function confirmDelete(exerciseId) {
                    if (confirm("Voulez-vous vraiment supprimer cet exercice ?")) {
                        window.location.href = `/workouts/<%= session._id %>/exercises/${exerciseId}/delete`;
                    }
                }
            </script>
</body>

</html>